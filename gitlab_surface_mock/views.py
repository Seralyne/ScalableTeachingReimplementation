from django.shortcuts import render
from django.http import HttpResponse
import json
# Create your views here.


# Contain the ugliness to one file, please.


# Incredibly dumb endpoint to simulate the GitLab API call that I need.
def index(request):
    object = """{"id":5942,"description":null,"name":"point-giving-activity-1-4oqonnvu","name_with_namespace":"Scalable Teaching Tasks / Videreg√•ende Objektorienteret Programming F23 / Point-giving Activity 1 / point-giving-activity-1-4oqonnvu","path":"point-giving-activity-1-4oqonnvu","path_with_namespace":"scalable-teaching-tasks/videregaende-objektorienteret-programming-f23/point-giving_activity1/point-giving-activity-1-4oqonnvu","created_at":"2023-03-02T00:57:21.868Z","default_branch":"assignment","tag_list":[],"topics":[],"ssh_url_to_repo":"git@gitlab.sdu.dk:scalable-teaching-tasks/videregaende-objektorienteret-programming-f23/point-giving_activity1/point-giving-activity-1-4oqonnvu.git","http_url_to_repo":"https://gitlab.sdu.dk/scalable-teaching-tasks/videregaende-objektorienteret-programming-f23/point-giving_activity1/point-giving-activity-1-4oqonnvu.git","web_url":"https://gitlab.sdu.dk/scalable-teaching-tasks/videregaende-objektorienteret-programming-f23/point-giving_activity1/point-giving-activity-1-4oqonnvu","readme_url":"https://gitlab.sdu.dk/scalable-teaching-tasks/videregaende-objektorienteret-programming-f23/point-giving_activity1/point-giving-activity-1-4oqonnvu/-/blob/assignment/README.md","forks_count":0,"avatar_url":null,"star_count":0,"last_activity_at":"2023-03-02T13:17:13.643Z","namespace":{"id":8020,"name":"Point-giving Activity 1","path":"point-giving_activity1","kind":"group","full_path":"scalable-teaching-tasks/videregaende-objektorienteret-programming-f23/point-giving_activity1","parent_id":7673,"avatar_url":null,"web_url":"https://gitlab.sdu.dk/groups/scalable-teaching-tasks/videregaende-objektorienteret-programming-f23/point-giving_activity1"},"container_registry_image_prefix":"registry.gitlab.sdu.dk/scalable-teaching-tasks/videregaende-objektorienteret-programming-f23/point-giving_activity1/point-giving-activity-1-4oqonnvu","_links":{"self":"https://gitlab.sdu.dk/api/v4/projects/5942","issues":"https://gitlab.sdu.dk/api/v4/projects/5942/issues","merge_requests":"https://gitlab.sdu.dk/api/v4/projects/5942/merge_requests","repo_branches":"https://gitlab.sdu.dk/api/v4/projects/5942/repository/branches","labels":"https://gitlab.sdu.dk/api/v4/projects/5942/labels","events":"https://gitlab.sdu.dk/api/v4/projects/5942/events","members":"https://gitlab.sdu.dk/api/v4/projects/5942/members","cluster_agents":"https://gitlab.sdu.dk/api/v4/projects/5942/cluster_agents"},"marked_for_deletion_at":null,"marked_for_deletion_on":null,"packages_enabled":true,"empty_repo":false,"archived":false,"visibility":"private","resolve_outdated_diff_discussions":false,"container_expiration_policy":{"cadence":"1d","enabled":false,"keep_n":10,"older_than":"90d","name_regex":".*","name_regex_keep":null,"next_run_at":"2023-03-03T00:57:21.874Z"},"repository_object_format":"sha1","issues_enabled":true,"merge_requests_enabled":true,"wiki_enabled":true,"jobs_enabled":true,"snippets_enabled":true,"container_registry_enabled":true,"service_desk_enabled":false,"service_desk_address":null,"can_create_merge_request_in":true,"issues_access_level":"enabled","repository_access_level":"enabled","merge_requests_access_level":"enabled","forking_access_level":"disabled","wiki_access_level":"enabled","builds_access_level":"enabled","snippets_access_level":"enabled","pages_access_level":"private","analytics_access_level":"enabled","container_registry_access_level":"enabled","security_and_compliance_access_level":"private","releases_access_level":"enabled","environments_access_level":"enabled","feature_flags_access_level":"enabled","infrastructure_access_level":"enabled","monitor_access_level":"enabled","model_experiments_access_level":"enabled","model_registry_access_level":"enabled","emails_disabled":false,"emails_enabled":true,"shared_runners_enabled":true,"lfs_enabled":false,"creator_id":358,"mr_default_target_self":false,"import_status":"finished","open_issues_count":0,"description_html":"","updated_at":"2023-03-02T13:28:31.390Z","ci_config_path":"","public_jobs":true,"shared_with_groups":[],"only_allow_merge_if_pipeline_succeeds":false,"allow_merge_on_skipped_pipeline":null,"request_access_enabled":true,"only_allow_merge_if_all_discussions_are_resolved":false,"remove_source_branch_after_merge":true,"printing_merge_request_link_enabled":true,"merge_method":"merge","merge_request_title_regex":null,"squash_option":"default_off","enforce_auth_checks_on_uploads":true,"suggestion_commit_message":null,"merge_commit_template":null,"squash_commit_template":null,"issue_branch_template":null,"warn_about_potentially_unwanted_characters":true,"autoclose_referenced_issues":true,"max_artifacts_size":null,"permissions":{"project_access":{"access_level":30,"notification_level":3},"group_access":null}}"""

    pythonic_object = json.loads(object)
    
    return HttpResponse(json.dumps(pythonic_object), content_type="application/json")



# Example output taken from GitLab's documentation and minified with z
# https://docs.gitlab.com/user/project/integrations/webhook_events/#pipeline-events
def pipeline_webhook_output(request):
    object = '''{"object_kind":"pipeline","object_attributes":{"id":31,"iid":3,"name":"Pipeline for branch: master","ref":"master","tag":false,"sha":"bcbb5ec396a2c0f828686f14fac9b80b780504f2","before_sha":"bcbb5ec396a2c0f828686f14fac9b80b780504f2","source":"merge_request_event","status":"success","stages":["build","test","deploy"],"created_at":"2016-08-12 15:23:28 UTC","finished_at":"2016-08-12 15:26:29 UTC","duration":63,"variables":[{"key":"NESTOR_PROD_ENVIRONMENT","value":"us-west-1"}],"url":"http://example.com/gitlab-org/gitlab-test/-/pipelines/31"},"merge_request":{"id":1,"iid":1,"title":"Test","source_branch":"test","source_project_id":1,"target_branch":"master","target_project_id":1,"state":"opened","merge_status":"can_be_merged","detailed_merge_status":"mergeable","url":"http://192.168.64.1:3005/gitlab-org/gitlab-test/merge_requests/1"},"user":{"id":1,"name":"Administrator","username":"root","avatar_url":"http://www.gravatar.com/avatar/e32bd13e2add097461cb96824b7a829c?s=80&d=identicon","email":"user_email@gitlab.com"},"project":{"id":1,"name":"Gitlab Test","description":"Atque in sunt eos similique dolores voluptatem.","web_url":"http://192.168.64.1:3005/gitlab-org/gitlab-test","avatar_url":null,"git_ssh_url":"git@192.168.64.1:gitlab-org/gitlab-test.git","git_http_url":"http://192.168.64.1:3005/gitlab-org/gitlab-test.git","namespace":"Gitlab Org","visibility_level":20,"path_with_namespace":"gitlab-org/gitlab-test","default_branch":"master"},"commit":{"id":"bcbb5ec396a2c0f828686f14fac9b80b780504f2","message":"test\n","timestamp":"2016-08-12T17:23:21+02:00","url":"http://example.com/gitlab-org/gitlab-test/commit/bcbb5ec396a2c0f828686f14fac9b80b780504f2","author":{"name":"User","email":"user@gitlab.com"}},"source_pipeline":{"project":{"id":41,"web_url":"https://gitlab.example.com/gitlab-org/upstream-project","path_with_namespace":"gitlab-org/upstream-project"},"pipeline_id":30,"job_id":3401},"builds":[{"id":380,"stage":"deploy","name":"production","status":"skipped","created_at":"2016-08-12 15:23:28 UTC","started_at":null,"finished_at":null,"duration":null,"queued_duration":null,"failure_reason":null,"when":"manual","manual":true,"allow_failure":false,"user":{"id":1,"name":"Administrator","username":"root","avatar_url":"http://www.gravatar.com/avatar/e32bd13e2add097461cb96824b7a829c?s=80&d=identicon","email":"admin@example.com"},"runner":null,"artifacts_file":{"filename":null,"size":null},"environment":{"name":"production","action":"start","deployment_tier":"production"}},{"id":377,"stage":"test","name":"test-image","status":"success","created_at":"2016-08-12 15:23:28 UTC","started_at":"2016-08-12 15:26:12 UTC","finished_at":"2016-08-12 15:26:29 UTC","duration":17,"queued_duration":196,"failure_reason":null,"when":"on_success","manual":false,"allow_failure":false,"user":{"id":1,"name":"Administrator","username":"root","avatar_url":"http://www.gravatar.com/avatar/e32bd13e2add097461cb96824b7a829c?s=80&d=identicon","email":"admin@example.com"},"runner":{"id":380987,"description":"shared-runners-manager-6.gitlab.com","active":true,"runner_type":"instance_type","is_shared":true,"tags":["linux","docker","shared-runner"]},"artifacts_file":{"filename":null,"size":null},"environment":null},{"id":378,"stage":"test","name":"test-build","status":"failed","created_at":"2016-08-12 15:23:28 UTC","started_at":"2016-08-12 15:26:12 UTC","finished_at":"2016-08-12 15:26:29 UTC","duration":17,"queued_duration":196,"failure_reason":"script_failure","when":"on_success","manual":false,"allow_failure":false,"user":{"id":1,"name":"Administrator","username":"root","avatar_url":"http://www.gravatar.com/avatar/e32bd13e2add097461cb96824b7a829c?s=80&d=identicon","email":"admin@example.com"},"runner":{"id":380987,"description":"shared-runners-manager-6.gitlab.com","active":true,"runner_type":"instance_type","is_shared":true,"tags":["linux","docker"]},"artifacts_file":{"filename":null,"size":null},"environment":null},{"id":376,"stage":"build","name":"build-image","status":"success","created_at":"2016-08-12 15:23:28 UTC","started_at":"2016-08-12 15:24:56 UTC","finished_at":"2016-08-12 15:25:26 UTC","duration":17,"queued_duration":196,"failure_reason":null,"when":"on_success","manual":false,"allow_failure":false,"user":{"id":1,"name":"Administrator","username":"root","avatar_url":"http://www.gravatar.com/avatar/e32bd13e2add097461cb96824b7a829c?s=80&d=identicon","email":"admin@example.com"},"runner":{"id":380987,"description":"shared-runners-manager-6.gitlab.com","active":true,"runner_type":"instance_type","is_shared":true,"tags":["linux","docker"]},"artifacts_file":{"filename":null,"size":null},"environment":null},{"id":379,"stage":"deploy","name":"staging","status":"created","created_at":"2016-08-12 15:23:28 UTC","started_at":null,"finished_at":null,"duration":null,"queued_duration":null,"failure_reason":null,"when":"on_success","manual":false,"allow_failure":false,"user":{"id":1,"name":"Administrator","username":"root","avatar_url":"http://www.gravatar.com/avatar/e32bd13e2add097461cb96824b7a829c?s=80&d=identicon","email":"admin@example.com"},"runner":null,"artifacts_file":{"filename":null,"size":null},"environment":{"name":"staging","action":"start","deployment_tier":"staging"}}]}'''


    pythonic_object = json.loads(object, strict=False)
    
    return HttpResponse(json.dumps(pythonic_object), content_type="application/json")